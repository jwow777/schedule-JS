(()=>{"use strict";function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var e=function(){function e(t){var r=t.baseUrl;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._baseUrl=r}var r,n;return r=e,(n=[{key:"_checkResponse",value:function(t){return t.ok?t.json():Promise.reject("Ошибка ".concat(t.status))}},{key:"getUsersInfo",value:function(t){return fetch("".concat(this._baseUrl,"?date=").concat(t)).then(this._checkResponse)}},{key:"postUsersInfo",value:function(t){return fetch("".concat(this._baseUrl),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),redirect:"follow"}).then(this._checkResponse)}},{key:"getSettings",value:function(){var t=new FormData;return t.append("action","get_schedule"),fetch("".concat(this._baseUrl),{method:"POST",body:t,redirect:"follow"}).then(this._checkResponse)}},{key:"saveSettings",value:function(t){return fetch("".concat(this._baseUrl),{method:"POST",body:t,redirect:"follow"}).then(this._checkResponse)}}])&&t(r.prototype,n),e}();function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=function(){function t(e,n){var a;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._popupSelector=e,this._popupForm=this._popupSelector.querySelector(".popup__form"),this._inputList=function(t){if(Array.isArray(t))return r(t)}(a=this._popupForm.querySelectorAll(".popup__input"))||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(a)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),this._buttonCancel=this._popupSelector.querySelector(".popup__button-form_cancel"),this._handleSubmitForm=n,this._handleClickCancel=this._handleClickCancel.bind(this)}var e,a;return e=t,(a=[{key:"open",value:function(){this._popupSelector.classList.add("popup_opened"),this._buttonCancel.addEventListener("click",this._handleClickCancel)}},{key:"close",value:function(){this._popupSelector.classList.remove("popup_opened"),this._buttonCancel.removeEventListener("click",this._handleClickCancel)}},{key:"_handleClickCancel",value:function(t){t.target===this._buttonCancel&&this.close()}},{key:"_getInputValues",value:function(){var t=this;return this._formValues={},this._inputList.forEach((function(e){return t._formValues[e.name]=e.value})),this._formValues}},{key:"setEventListeners",value:function(){var t=this;this._popupForm.addEventListener("submit",(function(e){e.preventDefault(),t._handleSubmitForm(t._getInputValues())}))}}])&&n(e.prototype,a),t}();function o(t){return function(t){if(Array.isArray(t))return s(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?s(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var i=function(){function t(e,r,n,a,o,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._data=e,this._day=e[0],this._time=e[1],this._stateForm=r,this._userId=n,this._name=a,this._userRow=o,this._userWorkDays=s}var e,r;return e=t,(r=[{key:"_getTemplateSelector",value:function(){return document.querySelector("#template").content.querySelector(".content__users-block_body").cloneNode(!0)}},{key:"generateSelector",value:function(){if(this._element=this._getTemplateSelector(),this._selectCurrent=this._element.querySelector(".select__current"),this._selectList=this._element.querySelector(".select__list"),this._selectInput=this._element.querySelector(".select__input"),this._selectItem=o(this._element.querySelectorAll(".select__item")),this._selectItemEmpty=this._selectList.querySelector(".select__item_empty"),this._selectItemRed=this._selectList.querySelector(".select__item_red"),this._selectItemYellow=this._selectList.querySelector(".select__item_yellow"),this._selectItemPurple=this._selectList.querySelector(".select__item_purple"),this._selectItemBlue=this._selectList.querySelector(".select__item_blue"),this._selectItemGreen=this._selectList.querySelector(".select__item_green"),this._selectCurrentButtonAtList=this._element.querySelector(".select__item_current"),this._selectInput.setAttribute("data-day",this._day),this._selectInput.setAttribute("data-id",this._userId),this._selectInput.setAttribute("data-name",this._name),this._selectInput.value=this._time,this._selectCurrent.setAttribute("data-value",this._time),this._selectCurrent.textContent=this._time,this._setEventListeners(),""===this._selectCurrent.getAttribute("data-value")&&(this._selectCurrent.classList.add("select__item_empty"),this._selectCurrent.setAttribute("data-color","empty")),this._selectItemRed.textContent="".concat(this._stateForm.timeRed.start,"-").concat(this._stateForm.timeRed.end),this._selectItemYellow.textContent="".concat(this._stateForm.timeYellow.start,"-").concat(this._stateForm.timeYellow.end),this._selectItemPurple.textContent="".concat(this._stateForm.timePurple.start,"-").concat(this._stateForm.timePurple.end),this._selectItemBlue.textContent="".concat(this._stateForm.timeBlue.start,"-").concat(this._stateForm.timeBlue.end),this._selectItemGreen.textContent="".concat(this._stateForm.timeGreen.start,"-").concat(this._stateForm.timeGreen.end),this._selectItemRed.setAttribute("data-value","".concat(this._stateForm.timeRed.start,"-").concat(this._stateForm.timeRed.end)),this._selectItemYellow.setAttribute("data-value","".concat(this._stateForm.timeYellow.start,"-").concat(this._stateForm.timeYellow.end)),this._selectItemPurple.setAttribute("data-value","".concat(this._stateForm.timePurple.start,"-").concat(this._stateForm.timePurple.end)),this._selectItemBlue.setAttribute("data-value","".concat(this._stateForm.timeBlue.start,"-").concat(this._stateForm.timeBlue.end)),this._selectItemGreen.setAttribute("data-value","".concat(this._stateForm.timeGreen.start,"-").concat(this._stateForm.timeGreen.end)),""!==this._selectCurrent.getAttribute("data-value"))if(this._selectCurrent.getAttribute("data-value")==="".concat(this._stateForm.timeRed.start,"-").concat(this._stateForm.timeRed.end))this._selectInput.setAttribute("data-color","red"),this._selectCurrent.setAttribute("data-color","red"),this._selectCurrent.classList.add("select__item_red");else if(this._selectCurrent.getAttribute("data-value")==="".concat(this._stateForm.timeYellow.start,"-").concat(this._stateForm.timeYellow.end))this._selectInput.setAttribute("data-color","yellow"),this._selectCurrent.setAttribute("data-color","yellow"),this._selectCurrent.classList.add("select__item_yellow");else if(this._selectCurrent.getAttribute("data-value")==="".concat(this._stateForm.timePurple.start,"-").concat(this._stateForm.timePurple.end))this._selectInput.setAttribute("data-color","purple"),this._selectCurrent.setAttribute("data-color","purple"),this._selectCurrent.classList.add("select__item_purple");else if(this._selectCurrent.getAttribute("data-value")==="".concat(this._stateForm.timeBlue.start,"-").concat(this._stateForm.timeBlue.end))this._selectInput.setAttribute("data-color","blue"),this._selectCurrent.setAttribute("data-color","blue"),this._selectCurrent.classList.add("select__item_blue");else{if(this._selectCurrent.getAttribute("data-value")!=="".concat(this._stateForm.timeGreen.start,"-").concat(this._stateForm.timeGreen.end))return;this._selectInput.setAttribute("data-color","green"),this._selectCurrent.setAttribute("data-color","green"),this._selectCurrent.classList.add("select__item_green")}return this._element}},{key:"_handleSelectOpen",value:function(){this._selectList.classList.add("select__list_show");var t=this._selectCurrent.getAttribute("data-value"),e=this._selectCurrent.getAttribute("data-color"),r=this._selectCurrent.className.split(" ")[1],n=this._selectCurrent.textContent;this._handleRemoveClasses(this._selectCurrentButtonAtList),this._selectCurrentButtonAtList.classList.add(r),this._selectCurrentButtonAtList.textContent=n,this._selectCurrentButtonAtList.setAttribute("data-value","".concat(t)),this._selectCurrentButtonAtList.setAttribute("data-color","".concat(e))}},{key:"_selectListHide",value:function(){this._selectList.classList.remove("select__list_show")}},{key:"_handleRemoveClasses",value:function(t){t.classList.remove("select__item_empty","select__item_red","select__item_yellow","select__item_purple","select__item_blue","select__item_green")}},{key:"_setEventListeners",value:function(){var t=this;this._selectCurrent.addEventListener("click",(function(){t._handleSelectOpen()})),this._selectItem.forEach((function(e){e.addEventListener("click",(function(){var r=e.getAttribute("data-value"),n=e.getAttribute("data-color"),a=e.textContent;t._selectInput.value=r,t._selectInput.setAttribute("data-color","".concat(n)),t._handleRemoveClasses(t._selectCurrent),t._selectCurrent.classList.add("select__item_".concat(n)),t._selectCurrent.textContent=a,t._selectCurrent.setAttribute("data-value","".concat(r)),t._selectCurrent.setAttribute("data-color","".concat(n)),t._userWorkDays.textContent=o(t._userRow.querySelectorAll("*:not(.select__item_empty).select__current")).length,t._selectListHide()}))})),document.addEventListener("mouseup",(function(e){t._selectList.contains(e.target)||t._selectListHide()}))}}])&&c(e.prototype,r),t}();function l(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._data=e,this._dataUserWork=e[1].date,this._stateForm=r,this._name=e[1].name,this._userId=e[0],this._counter=Object.entries(this._dataUserWork).filter((function(t){return""!==t[1]})).length}var e,r;return e=t,(r=[{key:"_getTemplate",value:function(){return document.querySelector("#template-user").content.querySelector(".content__users").cloneNode(!0)}},{key:"generateSelector",value:function(){var t=this;return this._element=this._getTemplate(),this._username=this._element.querySelector(".content__users-title_name"),this._userWorkDays=this._element.querySelector(".content__users-title_number"),this._username.textContent=this._name,this._userWorkDays.textContent=this._counter,Object.entries(this._dataUserWork).forEach((function(e){var r=new i(e,t._stateForm,t._userId,t._name,t._element,t._userWorkDays).generateSelector();t._element.append(r)})),this._element}}])&&l(e.prototype,r),t}(),_=document.querySelector(".header__data-text"),m=document.querySelector(".header__data-button_prev"),d=document.querySelector(".header__data-button_next"),h=document.querySelector(".popup"),p=document.querySelector(".header__button_save"),f=document.querySelector(".header__button_settings"),y=document.querySelector(".content__form"),b=document.querySelector(".content__header"),v=document.querySelector(".popup__form"),S=v.querySelector("input[name='redStart']"),g=v.querySelector("input[name='redEnd']"),A=v.querySelector("input[name='yellowStart']"),C=v.querySelector("input[name='yellowEnd']"),w=v.querySelector("input[name='purpleStart']"),k=v.querySelector("input[name='purpleEnd']"),I=v.querySelector("input[name='blueStart']"),L=v.querySelector("input[name='blueEnd']"),q=v.querySelector("input[name='greenStart']"),E=v.querySelector("input[name='greenEnd']");function F(t){return function(t){if(Array.isArray(t))return B(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||R(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function O(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?P(Object(r),!0).forEach((function(e){j(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function j(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function R(t,e){if(t){if("string"==typeof t)return B(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?B(t,e):void 0}}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var x,Y=new Date,G=Y.getFullYear(),U=Y.getMonth(),D=U+1<10?"0".concat(U+1):U+1,T=Y.getFullYear(),W=Y.getDate(),M=Y.toLocaleString("ru",{month:"long"}),V=new e({baseUrl:"https://scripts.qexsystems.ru/kmrd/schedule/settings.php"}),H={},N=[],$={};Promise.all([V.getUsersInfo("".concat(D,".").concat(G)),V.getSettings()]).then((function(t){var e,r,n=(r=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,a,o=[],s=!0,c=!1;try{for(r=r.call(t);!(s=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);s=!0);}catch(t){c=!0,a=t}finally{try{s||null==r.return||r.return()}finally{if(c)throw a}}return o}}(e,r)||R(e,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=n[0],o=n[1];H=a,$={timeRed:{start:(N=o)[0].substr(0,5),end:N[0].substr(6)},timeYellow:{start:N[1].substr(0,5),end:N[1].substr(6)},timePurple:{start:N[2].substr(0,5),end:N[2].substr(6)},timeBlue:{start:N[3].substr(0,5),end:N[3].substr(6)},timeGreen:{start:N[4].substr(0,5),end:N[4].substr(6)}},S.value=$.timeRed.start,g.value=$.timeRed.end,A.value=$.timeYellow.start,C.value=$.timeYellow.end,w.value=$.timePurple.start,k.value=$.timePurple.end,I.value=$.timeBlue.start,L.value=$.timeBlue.end,q.value=$.timeGreen.start,E.value=$.timeGreen.end,tt(H,$)})).catch((function(t){return console.log(t)}));var J=new a(h,(function(t){$=O(O({},$),{},{timeRed:O(O({},$.timeRed),{},{start:t.redStart,end:t.redEnd}),timeYellow:O(O({},$.timeYellow),{},{start:t.yellowStart,end:t.yellowEnd}),timePurple:O(O({},$.timePurple),{},{start:t.purpleStart,end:t.purpleEnd}),timeBlue:O(O({},$.timeBlue),{},{start:t.blueStart,end:t.blueEnd}),timeGreen:O(O({},$.timeGreen),{},{start:t.greenStart,end:t.greenEnd})}),["red","yellow","purple","blue","green"].forEach((function(t){z(t)}));var e=new FormData;e.append("action","schedule"),e.append("time[]","".concat($.timeRed.start,"-").concat($.timeRed.end)),e.append("time[]","".concat($.timeYellow.start,"-").concat($.timeYellow.end)),e.append("time[]","".concat($.timePurple.start,"-").concat($.timePurple.end)),e.append("time[]","".concat($.timeBlue.start,"-").concat($.timeBlue.end)),e.append("time[]","".concat($.timeGreen.start,"-").concat($.timeGreen.end)),V.saveSettings(e).then((function(t){return console.log(t)})).catch((function(t){return console.log(t)})),this.close()})),z=function(t){var e=F(y.querySelectorAll("div[data-color=".concat(t,"]"))),r=F(y.querySelectorAll(".select__input[data-color=".concat(t,"]")));e.forEach((function(e){"red"===t?(e.textContent="".concat($.timeRed.start,"-").concat($.timeRed.end),e.setAttribute("data-value","".concat($.timeRed.start,"-").concat($.timeRed.end))):"yellow"===t?(e.textContent="".concat($.timeYellow.start,"-").concat($.timeYellow.end),e.setAttribute("data-value","".concat($.timeYellow.start,"-").concat($.timeYellow.end))):"purple"===t?(e.textContent="".concat($.timePurple.start,"-").concat($.timePurple.end),e.setAttribute("data-value","".concat($.timePurple.start,"-").concat($.timePurple.end))):"blue"===t?(e.textContent="".concat($.timeBlue.start,"-").concat($.timeBlue.end),e.setAttribute("data-value","".concat($.timeBlue.start,"-").concat($.timeBlue.end))):"green"===t&&(e.textContent="".concat($.timeGreen.start,"-").concat($.timeGreen.end),e.setAttribute("data-value","".concat($.timeGreen.start,"-").concat($.timeGreen.end)))})),r.forEach((function(t){var e=t.closest(".select").querySelector(".select__current");t.value=e.getAttribute("data-value")}))},K=function(t){return M=t[0].toUpperCase()+t.slice(1)},Q=function(t,e){return 0===t||2===t||4===t||6===t||7===t||9===t||11===t?x=31:3===t||5===t||8===t||10===t?x=30:void(x=function(t){return t%100==0?t%400==0:t%4==0}(e)?29:28)},X=function(t,e,r){var n=new Date(t,e,r).getDay();return 0===n?"Вс":1===n?"Пн":2===n?"Вт":3===n?"Ср":4===n?"Чт":5===n?"Пт":6===n?"Сб":void 0},Z=function(t,e,r){for(var n=1;n<=t;n++){var a=e+1<10?"0".concat(e+1):e+1;b.insertAdjacentHTML("beforeend",'<div class="content__header-block content__header-block_day">\n        <p class="content__header-title content__header-title_month">\n        '.concat(n,".").concat(a,'</p>\n        <p class="content__header-title content__header-title_day-of-week">').concat(X(r,e,n),"</p>\n      </div>"))}},tt=function(t){Object.entries(t).forEach((function(t){var e=new u(t,$).generateSelector();y.append(e)}))},et=function(t,e,r){!function(){for(var t=document.querySelectorAll(".content__header-block_day"),e=0;e<t.length;e++)t[e].remove()}(),function(){for(var t=document.querySelectorAll(".content__users"),e=0;e<t.length;e++)t[e].remove()}(),Y=new Date(t,e,r),M=Y.toLocaleString("ru",{month:"long"}),K(M),_.textContent="".concat(M," ").concat(t),Q(e,t),Z(x,e,t);var n=e+1;D=e+1<10?"0".concat(n):"".concat(n),T=String(t);var a="".concat(n<10?"0".concat(n):n,".").concat(t);V.getUsersInfo(a).then((function(t){tt(H=t,$)})).catch((function(t){return console.log(t)}))};K(M),_.textContent="".concat(M," ").concat(G),Q(U,G),Z(x,U,G),J.setEventListeners(),m.addEventListener("click",(function(){0===U?et(G-=1,U=11,W):et(G,U-=1,W)})),d.addEventListener("click",(function(){11===U?et(G+=1,U=0,W):et(G,U+=1,W)})),p.addEventListener("click",(function(){var t={},e={};F(y.querySelectorAll(".content__users")).forEach((function(r){var n=r.querySelector(".select__input"),a=n.getAttribute("data-id"),o=n.getAttribute("data-name");F(r.querySelectorAll(".select__input")).forEach((function(t){var r=t.getAttribute("data-day"),n=t.value;e=O(O({},e),{},j({},r,n))})),t=O(O({},t),{},j({},a,{name:o,date:e}))}));var r={action:"save",date:D+"."+T,users:t};V.postUsersInfo(r).then((function(t){return console.log(t)})).catch((function(t){return console.log(t)}))})),f.addEventListener("click",(function(){return J.open()}))})();